<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="utf-8" />
  <title>Portfolio_bow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      overflow: hidden;
    }

    canvas {
      display: block;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dat.gui@0.7.9/build/dat.gui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.js"></script>
</head>

<body>
  <script>
    // Renderer
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    const scene = new THREE.Scene();

    // Camera
    const camera = new THREE.PerspectiveCamera(
      75,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    //camera.position.set(0, 30, 30);

    // --- FPS + Fly ---
    const fps = new THREE.PointerLockControls(camera, renderer.domElement);
    scene.add(fps.getObject());

    // คลิกแคนวาสเพื่อเข้าสู่โหมดเมาส์ล็อก
    renderer.domElement.addEventListener("click", () => fps.lock());

    // ปุ่มกด
    const keys = {
      w: false,
      a: false,
      s: false,
      d: false,
      shift: false,
      up: false,
      down: false,
    };
    addEventListener("keydown", (e) => {
      if (e.code === "KeyW") keys.w = true;
      if (e.code === "KeyA") keys.a = true;
      if (e.code === "KeyS") keys.s = true;
      if (e.code === "KeyD") keys.d = true;
      if (e.code === "ShiftLeft") keys.shift = true;
      if (e.code === "Space") keys.up = true;
      if (e.code === "ControlLeft" || e.code === "KeyC") keys.down = true;
    });
    addEventListener("keyup", (e) => {
      if (e.code === "KeyW") keys.w = false;
      if (e.code === "KeyA") keys.a = false;
      if (e.code === "KeyS") keys.s = false;
      if (e.code === "KeyD") keys.d = false;
      if (e.code === "ShiftLeft") keys.shift = false;
      if (e.code === "Space") keys.up = false;
      if (e.code === "ControlLeft" || e.code === "KeyC") keys.down = false;
    });
    fps.getObject().position.set(7, 18, 30);

    // เริ่มต้นระดับสายตา
    //camera.position.y = 1.6;

    // Light
    scene.add(new THREE.AmbientLight(0x808080));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(20, 20, 50);
    dirLight.castShadow = true;
    dirLight.shadow.mapSize.width = 1024;
    dirLight.shadow.mapSize.height = 1024;

    dirLight.shadow.camera.left = -50;
    dirLight.shadow.camera.right = 50;
    dirLight.shadow.camera.top = 50;
    dirLight.shadow.camera.bottom = -50;
    dirLight.shadow.camera.near = 1;
    dirLight.shadow.camera.far = 100;

    scene.add(dirLight);

    // GUI for light control
    const gui = new dat.GUI({ width: 600 });
    gui.domElement.style.maxHeight = "500px";
    gui.domElement.style.overflowY = "auto";
    const lightFolder = gui.addFolder("Directional Light");
    lightFolder.add(dirLight, "intensity", 0, 2, 0.01).name("Intensity");
    lightFolder
      .add(dirLight.position, "x", -100, 100, 0.1)
      .name("Position X");
    lightFolder.add(dirLight.position, "y", 0, 100, 0.1).name("Position Y");
    lightFolder
      .add(dirLight.position, "z", -100, 100, 0.1)
      .name("Position Z");
    lightFolder.open();

    // GUI แสดงตำแหน่งกล้อง FPS
    const cameraPosFolder = gui.addFolder("Camera Position (FPS)");
    cameraPosFolder.add(fps.getObject().position, "x").listen();
    cameraPosFolder.add(fps.getObject().position, "y").listen();
    cameraPosFolder.add(fps.getObject().position, "z").listen();
    cameraPosFolder.open();


    // Create ground plane
    const groundGeo = new THREE.PlaneGeometry(50, 50);
    const groundMat = new THREE.MeshStandardMaterial({
      color: 0x777777,
      roughness: 0.8,
      metalness: 0.2,
    });

    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = 0;
    ground.receiveShadow = true;
    scene.add(ground);

    // GLTF/GLB
    const draco = new THREE.DRACOLoader();
    draco.setDecoderPath(
      "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/draco/"
    );

    const loader = new THREE.GLTFLoader();
    loader.setDRACOLoader(draco);

    //ชื่อรหัสนิสิต
    loader.load(
      "https://Maniwan.github.io/Portfolio_bow/3DModels/name1.glb",
      (gltf) => {
        const name1 = gltf.scene;
        name1.traverse((o) => {
          if (o.isMesh) {
            o.castShadow = true;
            o.receiveShadow = true;
            if (o.material && o.material.map) {
              o.material.map.encoding = THREE.sRGBEncoding;
              o.material.needsUpdate = true;
            }
          }
        });
        name1.position.set(-93.4, 25, 75);
        name1.scale.set(2.5, 2.5, 2.5);
        //name1.rotation.y = Math.PI / 2;
        name1.rotation.y = THREE.MathUtils.degToRad(120);
        scene.add(name1);
      },
      (xhr) =>
        console.log(
          `Loading: ${(xhr.total
            ? (xhr.loaded / xhr.total) * 100
            : 0
          ).toFixed(1)}%`
        ),
      (err) => console.error(err)
    );

    //about me
    loader.load(
      "https://Maniwan.github.io/Portfolio_bow/3DModels/text.glb",
      (gltf) => {
        const text = gltf.scene;
        text.traverse((o) => {
          if (o.isMesh) {
            o.castShadow = true;
            o.receiveShadow = true;
            if (o.material && o.material.map) {
              o.material.map.encoding = THREE.sRGBEncoding;
              o.material.needsUpdate = true;
            }
          }
        });
        text.position.set(8.5,17,-9);
        text.scale.set(0.8,0.8,0.8);
        //manee.rotation.y = Math.PI / 2;
        text.rotation.y = THREE.MathUtils.degToRad(0);
        scene.add(text);
      },
      (xhr) =>
        console.log(
          `Loading: ${(xhr.total
            ? (xhr.loaded / xhr.total) * 100
            : 0
          ).toFixed(1)}%`
        ),
      (err) => console.error(err)
    );

    //ป้าย
     loader.load(
      "https://Maniwan.github.io/Portfolio_bow/3DModels/sign.glb",
      (gltf) => {
        const sign = gltf.scene;
        sign.traverse((o) => {
          if (o.isMesh) {
            o.castShadow = true;
            o.receiveShadow = true;
            if (o.material && o.material.map) {
              o.material.map.encoding = THREE.sRGBEncoding;
              o.material.needsUpdate = true;
            }
          }
        });
        sign.position.set(10,12.2,-9);
        sign.scale.set(3,3,3);
        //sign.rotation.y = Math.PI / 2;
        sign.rotation.y = THREE.MathUtils.degToRad(0);
        scene.add(sign);
      },
      (xhr) =>
        console.log(
          `Loading: ${(xhr.total
            ? (xhr.loaded / xhr.total) * 100
            : 0
          ).toFixed(1)}%`
        ),
      (err) => console.error(err)
    );

    //KU
    loader.load(
      "https://Maniwan.github.io/Portfolio_bow/3DModels/ku.glb",
      (gltf) => {
        const ku = gltf.scene;
        ku.traverse((o) => {
          if (o.isMesh) {
            o.castShadow = true;
            o.receiveShadow = true;
            if (o.material && o.material.map) {
              o.material.map.encoding = THREE.sRGBEncoding;
              o.material.needsUpdate = true;
            }
          }
        });
        ku.position.set(-93.4, 44, 75);
        ku.scale.set(6, 6, 6);
        //ku.rotation.y = Math.PI / 2;
        ku.rotation.y = THREE.MathUtils.degToRad(120);
        scene.add(ku);
      },
      (xhr) =>
        console.log(
          `Loading: ${(xhr.total
            ? (xhr.loaded / xhr.total) * 100
            : 0
          ).toFixed(1)}%`
        ),
      (err) => console.error(err)
    );

    //ท้องฟ้า
    loader.load(
      "https://Maniwan.github.io/Portfolio_bow/3DModels/skybox2.glb",
      (gltf) => {
        const skybox2 = gltf.scene;
        skybox2.traverse((o) => {
          if (o.isMesh) {
            o.castShadow = true;
            o.receiveShadow = true;
            if (o.material && o.material.map) {
              o.material.map.encoding = THREE.sRGBEncoding;
              o.material.needsUpdate = true;
            }
          }
        });
        skybox2.position.set(1, 1, 1);
        skybox2.scale.set(1, 1, 1);
        scene.add(skybox2);
      },
      (xhr) =>
        console.log(
          `Loading: ${(xhr.total
            ? (xhr.loaded / xhr.total) * 100
            : 0
          ).toFixed(1)}%`
        ),
      (err) => console.error(err)
    );
    
    //ปราสาท
    loader.load(
      "https://Maniwan.github.io/Portfolio_bow/3DModels/castle3.glb",
      (gltf) => {
        const castle3 = gltf.scene;
        castle3.traverse((o) => {
          if (o.isMesh) {
            o.castShadow = true;
            o.receiveShadow = true;
            if (o.material && o.material.map) {
              o.material.map.encoding = THREE.sRGBEncoding;
              o.material.needsUpdate = true;
            }
          }
        });
        castle3.position.set(1.5, 0.2, 0);

        scene.add(castle3);
      },
      (xhr) =>
        console.log(
          `Loading: ${(xhr.total
            ? (xhr.loaded / xhr.total) * 100
            : 0
          ).toFixed(1)}%`
        ),
      (err) => console.error(err)
    );

    //ตุ๊กตาบาร์บี้
     loader.load(
      "https://Maniwan.github.io/Portfolio_bow/3DModels/barbie.glb",
      (gltf) => {
        const barbie = gltf.scene;
        barbie.traverse((o) => {
          if (o.isMesh) {
            o.castShadow = true;
            o.receiveShadow = true;
            if (o.material && o.material.map) {
              o.material.map.encoding = THREE.sRGBEncoding;
              o.material.needsUpdate = true;
            }
          }
        });
        barbie.position.set(5, 12.2,-8);
        barbie.scale.set(3, 3, 3);
        //babie.rotation.y = Math.PI / 2;
        barbie.rotation.y = THREE.MathUtils.degToRad(-5);
        scene.add(barbie);d
      },
      (xhr) =>
        console.log(
          `Loading: ${(xhr.total
            ? (xhr.loaded / xhr.total) * 100
            : 0
          ).toFixed(1)}%`
        ),
      (err) => console.error(err)
    );

    //รูปนิสิต
     loader.load(
      "https://Maniwan.github.io/Portfolio_bow/3DModels/bow.glb",
      (gltf) => {
        const bow = gltf.scene;
        bow.traverse((o) => {
          if (o.isMesh) {
            o.castShadow = true;
            o.receiveShadow = true;
            if (o.material && o.material.map) {
              o.material.map.encoding = THREE.sRGBEncoding;
              o.material.needsUpdate = true;
            }
          }
        });
        bow.position.set(-93.4, 32, 75);
        bow.scale.set(5,5,5);
        //bow.rotation.y = Math.PI / 2;
        bow.rotation.y = THREE.MathUtils.degToRad(120);
        scene.add(bow);
      },

      (xhr) =>
        console.log(
          `Loading: ${(xhr.total
            ? (xhr.loaded / xhr.total) * 100
            : 0
          ).toFixed(1)}%`
        ),
      (err) => console.error(err)
    );


    // Loop
    (function animate() {
      requestAnimationFrame(animate);
      const dt = (
        window.__clock || (window.__clock = new THREE.Clock())
      ).getDelta();

      // เคลื่อนที่แบบ FPS + บิน
      if (fps.isLocked) {
        const SPEED = keys.shift ? 10 : 5; // Shift = วิ่งเร็ว
        const move = new THREE.Vector3();

        // ทิศหน้า/ขวาตามการหันของกล้องบนระนาบพื้น
        const fwd = new THREE.Vector3();
        camera.getWorldDirection(fwd);
        fwd.y = 0;
        fwd.normalize();
        const right = new THREE.Vector3()
          .crossVectors(fwd, camera.up)
          .normalize();

        if (keys.w) move.add(fwd);
        if (keys.s) move.sub(fwd);
        if (keys.a) move.sub(right);
        if (keys.d) move.add(right);

        if (move.lengthSq() > 0) {
          move.normalize().multiplyScalar(SPEED * dt);
          fps.getObject().position.add(move);
        }

        // บินขึ้น/ลง
        const v = (keys.up ? 1 : 0) - (keys.down ? 1 : 0);
        if (v !== 0) fps.getObject().position.y += v * SPEED * dt;
      }

      renderer.render(scene, camera);
    })();

    // --- Responsive Resize ---
    window.addEventListener("resize", () => {
      camera.aspect = innerWidth / innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
      // ► Correct color output
      renderer.outputEncoding = THREE.sRGBEncoding;
      renderer.setPixelRatio(window.devicePixelRatio || 1);
    });
  </script>
</body>

</html>
